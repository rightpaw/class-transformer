!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("stream")):"function"==typeof define&&define.amd?define(["exports","stream"],o):o((t="undefined"!=typeof globalThis?globalThis:t||self).ClassTransformer={},t.stream)}(this,(function(t,o){"use strict";var e;t.TransformationType=void 0,(e=t.TransformationType||(t.TransformationType={}))[e.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",e[e.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",e[e.CLASS_TO_CLASS=2]="CLASS_TO_CLASS";var n=new(function(){function o(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return o.prototype.addTypeMetadata=function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)},o.prototype.addTransformMetadata=function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)},o.prototype.addExposeMetadata=function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)},o.prototype.addExcludeMetadata=function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)},o.prototype.findTransformMetadatas=function(o,e,n){return this.findMetadatas(this._transformMetadatas,o,e).filter((function(o){return!o.options||(!0===o.options.toClassOnly&&!0===o.options.toPlainOnly||(!0===o.options.toClassOnly?n===t.TransformationType.CLASS_TO_CLASS||n===t.TransformationType.PLAIN_TO_CLASS:!0!==o.options.toPlainOnly||n===t.TransformationType.CLASS_TO_PLAIN))}))},o.prototype.findExcludeMetadata=function(t,o){return this.findMetadata(this._excludeMetadatas,t,o)},o.prototype.findExposeMetadata=function(t,o){return this.findMetadata(this._exposeMetadatas,t,o)},o.prototype.findExposeMetadataByCustomName=function(t,o){return this.getExposedMetadatas(t).find((function(t){return t.options&&t.options.name===o}))},o.prototype.findTypeMetadata=function(t,o){return this.findMetadata(this._typeMetadatas,t,o)},o.prototype.getStrategy=function(t){var o=this._excludeMetadatas.get(t),e=o&&o.get(void 0),n=this._exposeMetadatas.get(t),r=n&&n.get(void 0);return e&&r||!e&&!r?"none":e?"excludeAll":"exposeAll"},o.prototype.getExposedMetadatas=function(t){return this.getMetadata(this._exposeMetadatas,t)},o.prototype.getExcludedMetadatas=function(t){return this.getMetadata(this._excludeMetadatas,t)},o.prototype.getExposedProperties=function(o,e){return this.getExposedMetadatas(o).filter((function(o){return!o.options||(!0===o.options.toClassOnly&&!0===o.options.toPlainOnly||(!0===o.options.toClassOnly?e===t.TransformationType.CLASS_TO_CLASS||e===t.TransformationType.PLAIN_TO_CLASS:!0!==o.options.toPlainOnly||e===t.TransformationType.CLASS_TO_PLAIN))})).map((function(t){return t.propertyName}))},o.prototype.getExcludedProperties=function(o,e){return this.getExcludedMetadatas(o).filter((function(o){return!o.options||(!0===o.options.toClassOnly&&!0===o.options.toPlainOnly||(!0===o.options.toClassOnly?e===t.TransformationType.CLASS_TO_CLASS||e===t.TransformationType.PLAIN_TO_CLASS:!0!==o.options.toPlainOnly||e===t.TransformationType.CLASS_TO_PLAIN))})).map((function(t){return t.propertyName}))},o.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},o.prototype.getMetadata=function(t,o){var e,n=t.get(o);n&&(e=Array.from(n.values()).filter((function(t){return void 0!==t.propertyName})));for(var r=[],a=0,i=this.getAncestors(o);a<i.length;a++){var s=i[a],p=t.get(s);if(p){var f=Array.from(p.values()).filter((function(t){return void 0!==t.propertyName}));r.push.apply(r,f)}}return r.concat(e||[])},o.prototype.findMetadata=function(t,o,e){var n=t.get(o);if(n){var r=n.get(e);if(r)return r}for(var a=0,i=this.getAncestors(o);a<i.length;a++){var s=i[a],p=t.get(s);if(p){var f=p.get(e);if(f)return f}}},o.prototype.findMetadatas=function(t,o,e){var n,r=t.get(o);r&&(n=r.get(e));for(var a=[],i=0,s=this.getAncestors(o);i<s.length;i++){var p=s[i],f=t.get(p);f&&f.has(e)&&a.push.apply(a,f.get(e))}return a.slice().reverse().concat((n||[]).slice().reverse())},o.prototype.getAncestors=function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var o=[],e=Object.getPrototypeOf(t.prototype.constructor);void 0!==e.prototype;e=Object.getPrototypeOf(e.prototype.constructor))o.push(e);this._ancestorsMap.set(t,o)}return this._ancestorsMap.get(t)},o}());var r=function(){function e(t,o){this.transformationType=t,this.options=o,this.recursionStack=new Set}return e.prototype.transform=function(e,r,a,i,s,p){var f,u=this;if(void 0===p&&(p=0),Array.isArray(r)||r instanceof Set){var c=i&&this.transformationType===t.TransformationType.PLAIN_TO_CLASS?function(t){var o=new t;return o instanceof Set||"push"in o?o:[]}(i):[];return r.forEach((function(o,n){var r=e?e[n]:void 0;if(u.options.enableCircularCheck&&u.isCircular(o))u.transformationType===t.TransformationType.CLASS_TO_CLASS&&(c instanceof Set?c.add(o):c.push(o));else{var i=void 0;if("function"!=typeof a&&a&&a.options&&a.options.discriminator&&a.options.discriminator.property&&a.options.discriminator.subTypes){if(u.transformationType===t.TransformationType.PLAIN_TO_CLASS){i=a.options.discriminator.subTypes.find((function(t){return t.name===o[a.options.discriminator.property]}));var s={newObject:c,object:o,property:void 0},f=a.typeFunction(s);i=void 0===i?f:i.value,a.options.keepDiscriminatorProperty||delete o[a.options.discriminator.property]}u.transformationType===t.TransformationType.CLASS_TO_CLASS&&(i=o.constructor),u.transformationType===t.TransformationType.CLASS_TO_PLAIN&&(o[a.options.discriminator.property]=a.options.discriminator.subTypes.find((function(t){return t.value===o.constructor})).name)}else i=a;var l=u.transform(r,o,i,void 0,o instanceof Map,p+1);c instanceof Set?c.add(l):c.push(l)}})),c}if(a!==String||s){if(a!==Number||s){if(a!==Boolean||s){if((a===Date||r instanceof Date)&&!s)return r instanceof Date?new Date(r.valueOf()):null==r?r:new Date(r);if(r instanceof o.Readable)return r;if(("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(a===Buffer||r instanceof Buffer)&&!s)return null==r?r:Buffer.from(r);if(null===(f=r)||"object"!=typeof f||"function"!=typeof f.then||s){if(s||null===r||"object"!=typeof r||"function"!=typeof r.then){if("object"==typeof r&&null!==r){a||r.constructor===Object||(a=r.constructor),!a&&e&&(a=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(r);var l=this.getKeys(a,r,s),d=e||{};e||this.transformationType!==t.TransformationType.PLAIN_TO_CLASS&&this.transformationType!==t.TransformationType.CLASS_TO_CLASS||(d=s?new Map:a?new a:{});for(var y=function(o){if("__proto__"===o||"constructor"===o)return"continue";var i=o,f=o,u=o;if(!T.options.ignoreDecorators&&a)if(T.transformationType===t.TransformationType.PLAIN_TO_CLASS)(c=n.findExposeMetadataByCustomName(a,o))&&(u=c.propertyName,f=c.propertyName);else if(T.transformationType===t.TransformationType.CLASS_TO_PLAIN||T.transformationType===t.TransformationType.CLASS_TO_CLASS){var c;(c=n.findExposeMetadata(a,o))&&c.options&&c.options.name&&(f=c.options.name)}var l=void 0;l=r instanceof Map?r.get(i):r[i]instanceof Function?r[i]():r[i];var y=void 0,m=l instanceof Map;if(a&&s)y=a;else if(a){var v=n.findTypeMetadata(a,u);if(v){var h={newObject:d,object:r,property:u},S=v.typeFunction?v.typeFunction(h):v.reflectedType;v.options&&v.options.discriminator&&v.options.discriminator.property&&v.options.discriminator.subTypes?r[i]instanceof Array?y=v:(T.transformationType===t.TransformationType.PLAIN_TO_CLASS&&(y=void 0===(y=v.options.discriminator.subTypes.find((function(t){if(l&&l instanceof Object&&v.options.discriminator.property in l)return t.name===l[v.options.discriminator.property]})))?S:y.value,v.options.keepDiscriminatorProperty||l&&l instanceof Object&&v.options.discriminator.property in l&&delete l[v.options.discriminator.property]),T.transformationType===t.TransformationType.CLASS_TO_CLASS&&(y=l.constructor),T.transformationType===t.TransformationType.CLASS_TO_PLAIN&&(l[v.options.discriminator.property]=v.options.discriminator.subTypes.find((function(t){return t.value===l.constructor})).name)):y=S,m=m||v.reflectedType===Map}else if(T.options.targetMaps)T.options.targetMaps.filter((function(t){return t.target===a&&!!t.properties[u]})).forEach((function(t){return y=t.properties[u]}));else if(T.options.enableImplicitConversion&&T.transformationType===t.TransformationType.PLAIN_TO_CLASS){var _=Reflect.getMetadata("design:type",a.prototype,u);_&&(y=_)}}var g=Array.isArray(r[i])?T.getReflectedType(a,u):void 0,C=e?e[i]:void 0;if(d.constructor.prototype){var A=Object.getOwnPropertyDescriptor(d.constructor.prototype,f);if((T.transformationType===t.TransformationType.PLAIN_TO_CLASS||T.transformationType===t.TransformationType.CLASS_TO_CLASS)&&(A&&!A.set||d[f]instanceof Function))return"continue"}if(T.options.enableCircularCheck&&T.isCircular(l)){if(T.transformationType===t.TransformationType.CLASS_TO_CLASS){L=l;(void 0!==(L=T.applyCustomTransformations(L,a,o,r,T.transformationType))||T.options.exposeUnsetFields)&&(d instanceof Map?d.set(f,L):d[f]=L)}}else{var M=T.transformationType===t.TransformationType.PLAIN_TO_CLASS?f:o,L=void 0;T.transformationType===t.TransformationType.CLASS_TO_PLAIN?(L=r[M],L=T.applyCustomTransformations(L,a,M,r,T.transformationType),L=r[M]===L?l:L,L=T.transform(C,L,y,g,m,p+1)):void 0===l&&T.options.exposeDefaultValues?L=d[f]:(L=T.transform(C,l,y,g,m,p+1),L=T.applyCustomTransformations(L,a,M,r,T.transformationType)),(void 0!==L||T.options.exposeUnsetFields)&&(d instanceof Map?d.set(f,L):d[f]=L)}},T=this,m=0,v=l;m<v.length;m++){y(v[m])}return this.options.enableCircularCheck&&this.recursionStack.delete(r),d}return r}return r}return new Promise((function(t,o){r.then((function(o){return t(u.transform(void 0,o,a,void 0,void 0,p+1))}),o)}))}return null==r?r:Boolean(r)}return null==r?r:Number(r)}return null==r?r:String(r)},e.prototype.applyCustomTransformations=function(t,o,e,r,a){var i=this,s=n.findTransformMetadatas(o,e,this.transformationType);return void 0!==this.options.version&&(s=s.filter((function(t){return!t.options||i.checkVersion(t.options.since,t.options.until)}))),(s=this.options.groups&&this.options.groups.length?s.filter((function(t){return!t.options||i.checkGroups(t.options.groups)})):s.filter((function(t){return!t.options||!t.options.groups||!t.options.groups.length}))).forEach((function(o){t=o.transformFn({value:t,key:e,obj:r,type:a,options:i.options})})),t},e.prototype.isCircular=function(t){return this.recursionStack.has(t)},e.prototype.getReflectedType=function(t,o){if(t){var e=n.findTypeMetadata(t,o);return e?e.reflectedType:void 0}},e.prototype.getKeys=function(o,e,r){var a=this,i=n.getStrategy(o);"none"===i&&(i=this.options.strategy||"exposeAll");var s=[];if(("exposeAll"===i||r)&&(s=e instanceof Map?Array.from(e.keys()):Object.keys(e)),r)return s;if(!this.options.ignoreDecorators&&o){var p=n.getExposedProperties(o,this.transformationType);this.transformationType===t.TransformationType.PLAIN_TO_CLASS&&(p=p.map((function(t){var e=n.findExposeMetadata(o,t);return e&&e.options&&e.options.name?e.options.name:t}))),s=this.options.excludeExtraneousValues?p:s.concat(p);var f=n.getExcludedProperties(o,this.transformationType);f.length>0&&(s=s.filter((function(t){return!f.includes(t)}))),void 0!==this.options.version&&(s=s.filter((function(t){var e=n.findExposeMetadata(o,t);return!e||!e.options||a.checkVersion(e.options.since,e.options.until)}))),s=this.options.groups&&this.options.groups.length?s.filter((function(t){var e=n.findExposeMetadata(o,t);return!e||!e.options||a.checkGroups(e.options.groups)})):s.filter((function(t){var e=n.findExposeMetadata(o,t);return!(e&&e.options&&e.options.groups&&e.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(s=s.filter((function(t){return a.options.excludePrefixes.every((function(o){return t.substr(0,o.length)!==o}))}))),s=s.filter((function(t,o,e){return e.indexOf(t)===o}))},e.prototype.checkVersion=function(t,o){var e=!0;return e&&t&&(e=this.options.version>=t),e&&o&&(e=this.options.version<o),e},e.prototype.checkGroups=function(t){return!t||this.options.groups.some((function(o){return t.includes(o)}))},e}(),a={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},i=function(){return(i=Object.assign||function(t){for(var o,e=1,n=arguments.length;e<n;e++)for(var r in o=arguments[e])Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t}).apply(this,arguments)},s=function(){function o(){}return o.prototype.classToPlain=function(o,e){return new r(t.TransformationType.CLASS_TO_PLAIN,i(i({},a),e)).transform(void 0,o,void 0,void 0,void 0,void 0)},o.prototype.classToPlainFromExist=function(o,e,n){return new r(t.TransformationType.CLASS_TO_PLAIN,i(i({},a),n)).transform(e,o,void 0,void 0,void 0,void 0)},o.prototype.plainToClass=function(o,e,n){return new r(t.TransformationType.PLAIN_TO_CLASS,i(i({},a),n)).transform(void 0,e,o,void 0,void 0,void 0)},o.prototype.plainToClassFromExist=function(o,e,n){return new r(t.TransformationType.PLAIN_TO_CLASS,i(i({},a),n)).transform(o,e,void 0,void 0,void 0,void 0)},o.prototype.classToClass=function(o,e){return new r(t.TransformationType.CLASS_TO_CLASS,i(i({},a),e)).transform(void 0,o,void 0,void 0,void 0,void 0)},o.prototype.classToClassFromExist=function(o,e,n){return new r(t.TransformationType.CLASS_TO_CLASS,i(i({},a),n)).transform(e,o,void 0,void 0,void 0,void 0)},o.prototype.serialize=function(t,o){return JSON.stringify(this.classToPlain(t,o))},o.prototype.deserialize=function(t,o,e){var n=JSON.parse(o);return this.plainToClass(t,n,e)},o.prototype.deserializeArray=function(t,o,e){var n=JSON.parse(o);return this.plainToClass(t,n,e)},o}();var p=new s;t.ClassTransformer=s,t.Exclude=function(t){return void 0===t&&(t={}),function(o,e){n.addExcludeMetadata({target:o instanceof Function?o:o.constructor,propertyName:e,options:t})}},t.Expose=function(t){return void 0===t&&(t={}),function(o,e){n.addExposeMetadata({target:o instanceof Function?o:o.constructor,propertyName:e,options:t})}},t.Transform=function(t,o){return void 0===o&&(o={}),function(e,r){n.addTransformMetadata({target:e.constructor,propertyName:r,transformFn:t,options:o})}},t.TransformClassToClass=function(t){return function(o,e,n){var r=new s,a=n.value;n.value=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];var n=a.apply(this,o),i=!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then;return i?n.then((function(o){return r.classToClass(o,t)})):r.classToClass(n,t)}}},t.TransformClassToPlain=function(t){return function(o,e,n){var r=new s,a=n.value;n.value=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];var n=a.apply(this,o),i=!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then;return i?n.then((function(o){return r.classToPlain(o,t)})):r.classToPlain(n,t)}}},t.TransformPlainToClass=function(t,o){return function(e,n,r){var a=new s,i=r.value;r.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=i.apply(this,e),s=!!r&&("object"==typeof r||"function"==typeof r)&&"function"==typeof r.then;return s?r.then((function(e){return a.plainToClass(t,e,o)})):a.plainToClass(t,r,o)}}},t.Type=function(t,o){return void 0===o&&(o={}),function(e,r){var a=Reflect.getMetadata("design:type",e,r);n.addTypeMetadata({target:e.constructor,propertyName:r,reflectedType:a,typeFunction:t,options:o})}},t.classToClass=function(t,o){return p.classToClass(t,o)},t.classToClassFromExist=function(t,o,e){return p.classToClassFromExist(t,o,e)},t.classToPlain=function(t,o){return p.classToPlain(t,o)},t.classToPlainFromExist=function(t,o,e){return p.classToPlainFromExist(t,o,e)},t.deserialize=function(t,o,e){return p.deserialize(t,o,e)},t.deserializeArray=function(t,o,e){return p.deserializeArray(t,o,e)},t.plainToClass=function(t,o,e){return p.plainToClass(t,o,e)},t.plainToClassFromExist=function(t,o,e){return p.plainToClassFromExist(t,o,e)},t.serialize=function(t,o){return p.serialize(t,o)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=class-transformer.umd.min.js.map
